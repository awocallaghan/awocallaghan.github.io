{"version":3,"sources":["projects.js"],"names":["PROJECTS_SELECTOR","PROJECT_SELECTOR","PROJECTS_DATA","PROJECT_DATA","DEBUG","$","element","get","data","console","log","initFilters","initProjects","projects","fail","err","error","responseText","projectsElement","title","find","append","after","on","filtersUpdated","each","index","thisProjectElement","event","preventDefault","filters","serializeArray","reduce","obj","item","value","length","hasOwnProperty","name","constructor","Array","push","filterKeys","Object","keys","filter","key","projectElements","hide","projectElement","projectData","Error","showProject","search","toLowerCase","description","indexOf","i","filterName","filterValue","show","j","k","resetFilters","reset"],"mappings":"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","file":"projects.dist.js","sourcesContent":["'use strict';\r\n\r\n/**\r\n * Filter through project data\r\n * @author Alex O'Callaghan\r\n */\r\n\r\nconst PROJECTS_SELECTOR = '#projects';\r\nconst PROJECT_SELECTOR = '.post-preview';\r\nconst PROJECTS_DATA = 'projects';\r\nconst PROJECT_DATA = 'project';\r\n// Debug to console\r\nconst DEBUG = false;\r\n\r\n/**\r\n * Load data and initialise when page ready\r\n */\r\n$(function () {\r\n  let element = $(PROJECTS_SELECTOR);\r\n\r\n  $.get('/api/projects.json', function (data) {\r\n    if (DEBUG) {\r\n      console.log('Successfully loaded projects data', data);\r\n    }\r\n    element.data(PROJECTS_DATA, data);\r\n    initFilters(element);\r\n    initProjects(element, data.projects);\r\n  }).fail(function (err) {\r\n    console.error('Error loading project data', err);\r\n    console.log(err.responseText);\r\n  });\r\n});\r\n\r\n// Setup the filter controls\r\nfunction initFilters (projectsElement) {\r\n  let title = projectsElement.find('h2');\r\n  // Add filter trigger link\r\n  title.append('<a class=\"filter-toggler collapsed\" data-toggle=\"collapse\" href=\"#projects-filters\"><i class=\"fa fa-filter\" aria-hidden=\"true\"></i>Filter</a>');\r\n  // Add filter toggleable content\r\n  title.after('<div id=\"projects-filters\" class=\"collapse\"><form class=\"row\"><div class=\"col-xs-12 col-sm-6\"><div class=\"form-group\"><label for=\"search\">Search</label><input type=\"text\" class=\"form-control\" name=\"search\" placeholder=\"Some text...\" /></div><div class=\"form-group\"><label for=\"tags\">Tags</label><select class=\"form-control\" multiple name=\"tags\"><option selected value>All</option><option value=\"JavaScript\">JavaScript</option><option value=\"PHP\">PHP</option><option value=\"Java\">Java</option></select></div></div><div class=\"col-xs-12 col-sm-6\"><button class=\"btn btn-primary\" role=\"submit\">Update</button><a class=\"btn btn-secondary\" onclick=\"resetFilters()\" href=\"#projects-filters\">Reset</a></div></form></div>');\r\n  // Add handling on filter change\r\n  $('#projects-filters form').on('submit', filtersUpdated);\r\n}\r\n\r\n// Tag each project element with its index\r\nfunction initProjects (projectsElement, projects) {\r\n  projectsElement.find(PROJECT_SELECTOR).each(function (index) {\r\n    let thisProjectElement = $(this);\r\n    thisProjectElement.data(PROJECT_DATA, projects[index]);\r\n  });\r\n}\r\n\r\n// Filters have updated\r\n// - Filters have been changed, update the shown projects\r\nfunction filtersUpdated (event) {\r\n  // Stop form submission refresh\r\n  if (event) event.preventDefault();\r\n\r\n  // Get the filters as an object\r\n  let filters = $(this).serializeArray().reduce(function(obj, item) {\r\n    // Don't save empty values\r\n    if (item.value && item.value.length > 0) {\r\n      // Property with multiple values = array\r\n      if (!obj.hasOwnProperty(item.name)) {\r\n        obj[item.name] = item.value;\r\n      } else if (obj[item.name].constructor === Array) {\r\n        obj[item.name].push(item.value);\r\n      } else {\r\n        obj[item.name] = [ obj[item.name], item.value ];\r\n      }\r\n    }\r\n    return obj;\r\n  }, {});\r\n  let filterKeys = Object.keys(filters).filter(function (key) {\r\n    return key !== 'search';\r\n  });\r\n\r\n  let projectElements = $(PROJECTS_SELECTOR + ' ' + PROJECT_SELECTOR);\r\n\r\n  // Hide all the projects\r\n  projectElements.hide();\r\n\r\n  // Show project if it matches the filters\r\n  projectElements.each(function (index) {\r\n    let projectElement = $(this);\r\n    let projectData = projectElement.data(PROJECT_DATA);\r\n\r\n    if (!projectData) throw new Error(`No project data for index ${index}`);\r\n\r\n    let showProject = true;\r\n\r\n    // Handle 'search' string filter\r\n    // - Search for the string in 'name' and 'description'\r\n    if (filters.hasOwnProperty('search')) {\r\n      filters.search = filters.search.toLowerCase();\r\n      let name = projectData.name.toLowerCase(),\r\n          description = projectData.description.toLowerCase();\r\n      showProject = name.indexOf(filters.search) >= 0 ||\r\n                    description.indexOf(filters.search) >= 0;\r\n    }\r\n\r\n    // Check each filter\r\n    let i = 0;\r\n    while (showProject && i < filterKeys.length) {\r\n      let filterName = filterKeys[i];\r\n      let filterValue = filters[filterName];\r\n      if (filterValue.constructor === Array) {\r\n        if (projectData[filterName].constructor === Array) {\r\n          // Array filter value, array project value\r\n          // - Search both arrays as OR tests\r\n          let show = false,\r\n              j = 0,\r\n              k = 0;\r\n          while (!show && k < projectData[filterName].length) {\r\n            let j = 0;\r\n            while (!show && j < filterValue.length) {\r\n              show = projectData[filterName][k] === filterValue[j];\r\n              j++;\r\n            }\r\n            k++;\r\n          }\r\n          showProject = show;\r\n        } else {\r\n          // Array filter value, single project value\r\n          // - Treat array of filters as OR test\r\n          let show = false,\r\n              j = 0;\r\n          while (!show && j < filterValue.length) {\r\n            show = projectData[filterName] === filterValue[j];\r\n            j++;\r\n          }\r\n          showProject = show;\r\n        }\r\n      } else {\r\n        if (projectData[filterName].constructor === Array) {\r\n          // Single filter value, array project value\r\n          let show = false,\r\n            j = 0;\r\n          while (!show && j < projectData[filterName].length) {\r\n            show = projectData[filterName][j] === filterValue;\r\n            j++;\r\n          }\r\n          showProject = show;\r\n        } else {\r\n          // Single filter value, single project value\r\n          // - Simple equality check\r\n          showProject = projectData[filterName] === filterValue;\r\n        }\r\n      }\r\n      if (DEBUG && !showProject) {\r\n        console.log(projectData[filterName], 'not matches filter:', filterValue);\r\n      } else if (DEBUG) {\r\n        console.log(projectData[filterName], 'matches filter:', filterValue);\r\n      }\r\n      i++;\r\n    }\r\n\r\n    // Show the project\r\n    if (showProject) projectElement.show();\r\n  });\r\n}\r\n\r\n// Reset filters form + projects shown\r\nfunction resetFilters () {\r\n  $('#projects-filters form')[0].reset();\r\n  filtersUpdated();\r\n}\r\n"]}