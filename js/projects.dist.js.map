{"version":3,"sources":["projects.js"],"names":["PROJECTS_SELECTOR","PROJECT_SELECTOR","PROJECT_FILTERS_SELECTOR","PROJECTS_COUNT_SELECTOR","PROJECTS_DATA","PROJECT_DATA","DEBUG","$","element","get","data","projects","slice","length","console","log","initFilters","initProjects","initProjectCount","fail","err","error","responseText","projectsElement","title","find","append","after","on","filtersUpdated","each","index","thisProjectElement","event","preventDefault","filters","serializeArray","reduce","obj","item","value","hasOwnProperty","name","constructor","Array","push","filterKeys","Object","keys","filter","key","projectElements","hide","projectCount","projectElement","projectData","Error","showProject","search","toLowerCase","description","indexOf","i","filterName","filterValue","show","j","k","updateProjectCount","resetFilters","reset","count","text"],"mappings":"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","file":"projects.dist.js","sourcesContent":["'use strict';\r\n\r\n/**\r\n * Filter through project data\r\n * @author Alex O'Callaghan\r\n */\r\n\r\nconst PROJECTS_SELECTOR = '#projects';\r\nconst PROJECT_SELECTOR = '.post-preview';\r\nconst PROJECT_FILTERS_SELECTOR = '#projects-filters';\r\nconst PROJECTS_COUNT_SELECTOR = '#projects-count';\r\nconst PROJECTS_DATA = 'projects';\r\nconst PROJECT_DATA = 'project';\r\n// Debug to console\r\nconst DEBUG = false;\r\n\r\n/**\r\n * Load data and initialise when page ready\r\n */\r\n$(function () {\r\n  let element = $(PROJECTS_SELECTOR);\r\n\r\n  $.get('/api/projects.json', function (data) {\r\n    // Last project in array is an empty {}\r\n    data.projects = data.projects.slice(0, data.projects.length - 1);\r\n    if (DEBUG) {\r\n      console.log('Successfully loaded projects data', data);\r\n    }\r\n    element.data(PROJECTS_DATA, data);\r\n    initFilters(element, data.projects);\r\n    initProjects(element, data.projects);\r\n    initProjectCount(element, data.projects);\r\n  }).fail(function (err) {\r\n    console.error('Error loading project data', err);\r\n    console.log(err.responseText);\r\n  });\r\n});\r\n\r\n// Setup the filter controls\r\nfunction initFilters (projectsElement, projects) {\r\n  let title = projectsElement.find('h2');\r\n  // Add filter trigger link\r\n  title.append('<a class=\"filter-toggler collapsed\" data-toggle=\"collapse\" href=\"#projects-filters\"><i class=\"fa fa-filter\" aria-hidden=\"true\"></i>Filter</a>');\r\n  // Add filter toggleable content\r\n  title.after('<div id=\"projects-filters\" class=\"collapse\"><form class=\"row\"><div class=\"col-12\"><div class=\"form-group\"><label for=\"search\">Search</label><input type=\"text\" class=\"form-control\" name=\"search\" placeholder=\"Some text...\" /></div><div class=\"form-group\"><label for=\"tags\">Tags</label><select class=\"form-control\" multiple name=\"tags\"><option selected value>All</option><option value=\"JavaScript\">JavaScript</option><option value=\"PHP\">PHP</option><option value=\"Java\">Java</option></select></div></div><div class=\"col-12\"><button class=\"btn btn-primary\" role=\"submit\">Update</button><a class=\"btn btn-secondary\" onclick=\"resetFilters()\" href=\"#projects-filters\">Reset</a></div></form></div>');\r\n  // Add handling on filter change\r\n  $('#projects-filters form').on('submit', filtersUpdated);\r\n}\r\n\r\n// Tag each project element with its index\r\nfunction initProjects (projectsElement, projects) {\r\n  projectsElement.find(PROJECT_SELECTOR).each(function (index) {\r\n    let thisProjectElement = $(this);\r\n    thisProjectElement.data(PROJECT_DATA, projects[index]);\r\n  });\r\n}\r\n\r\n// Filters have updated\r\n// - Filters have been changed, update the shown projects\r\nfunction filtersUpdated (event) {\r\n  // Stop form submission refresh\r\n  if (event) event.preventDefault();\r\n\r\n  // Get the filters as an object\r\n  let filters = $(this).serializeArray().reduce(function(obj, item) {\r\n    // Don't save empty values\r\n    if (item.value && item.value.length > 0) {\r\n      // Property with multiple values = array\r\n      if (!obj.hasOwnProperty(item.name)) {\r\n        obj[item.name] = item.value;\r\n      } else if (obj[item.name].constructor === Array) {\r\n        obj[item.name].push(item.value);\r\n      } else {\r\n        obj[item.name] = [ obj[item.name], item.value ];\r\n      }\r\n    }\r\n    return obj;\r\n  }, {});\r\n  let filterKeys = Object.keys(filters).filter(function (key) {\r\n    return key !== 'search';\r\n  });\r\n\r\n  let projectElements = $(PROJECTS_SELECTOR + ' ' + PROJECT_SELECTOR);\r\n\r\n  // Hide all the projects\r\n  projectElements.hide();\r\n\r\n  // Count how many projects we show\r\n  let projectCount = 0;\r\n\r\n  // Show project if it matches the filters\r\n  projectElements.each(function (index) {\r\n    let projectElement = $(this);\r\n    let projectData = projectElement.data(PROJECT_DATA);\r\n\r\n    if (!projectData) throw new Error(`No project data for index ${index}`);\r\n\r\n    let showProject = true;\r\n\r\n    // Handle 'search' string filter\r\n    // - Search for the string in 'name' and 'description'\r\n    if (filters.hasOwnProperty('search')) {\r\n      filters.search = filters.search.toLowerCase();\r\n      let name = projectData.name.toLowerCase(),\r\n          description = projectData.description.toLowerCase();\r\n      showProject = name.indexOf(filters.search) >= 0 ||\r\n                    description.indexOf(filters.search) >= 0;\r\n    }\r\n\r\n    // Check each filter\r\n    let i = 0;\r\n    while (showProject && i < filterKeys.length) {\r\n      let filterName = filterKeys[i];\r\n      let filterValue = filters[filterName];\r\n      if (filterValue.constructor === Array) {\r\n        if (projectData[filterName].constructor === Array) {\r\n          // Array filter value, array project value\r\n          // - Search both arrays as OR tests\r\n          let show = false,\r\n              j = 0,\r\n              k = 0;\r\n          while (!show && k < projectData[filterName].length) {\r\n            let j = 0;\r\n            while (!show && j < filterValue.length) {\r\n              show = projectData[filterName][k] === filterValue[j];\r\n              j++;\r\n            }\r\n            k++;\r\n          }\r\n          showProject = show;\r\n        } else {\r\n          // Array filter value, single project value\r\n          // - Treat array of filters as OR test\r\n          let show = false,\r\n              j = 0;\r\n          while (!show && j < filterValue.length) {\r\n            show = projectData[filterName] === filterValue[j];\r\n            j++;\r\n          }\r\n          showProject = show;\r\n        }\r\n      } else {\r\n        if (projectData[filterName].constructor === Array) {\r\n          // Single filter value, array project value\r\n          let show = false,\r\n            j = 0;\r\n          while (!show && j < projectData[filterName].length) {\r\n            show = projectData[filterName][j] === filterValue;\r\n            j++;\r\n          }\r\n          showProject = show;\r\n        } else {\r\n          // Single filter value, single project value\r\n          // - Simple equality check\r\n          showProject = projectData[filterName] === filterValue;\r\n        }\r\n      }\r\n      if (DEBUG && !showProject) {\r\n        console.log(projectData[filterName], 'does not match filter:', filterValue);\r\n      } else if (DEBUG) {\r\n        console.log(projectData[filterName], 'matches filter:', filterValue);\r\n      }\r\n      i++;\r\n    }\r\n\r\n    // Show the project\r\n    if (showProject) {\r\n      projectElement.show();\r\n      projectCount += 1;\r\n    }\r\n\r\n    // Update shown projects count\r\n    if (index === projectElements.length - 1) {\r\n      updateProjectCount(projectCount);\r\n    }\r\n  });\r\n}\r\n\r\n// Reset filters form + projects shown\r\nfunction resetFilters () {\r\n  $(PROJECT_FILTERS_SELECTOR + ' form')[0].reset();\r\n  filtersUpdated();\r\n}\r\n\r\n// Init project count text\r\nfunction initProjectCount (element, projects) {\r\n  element.find(PROJECT_FILTERS_SELECTOR).after('<span id=\"projects-count\"></span>');\r\n  updateProjectCount(projects.length);\r\n}\r\n\r\n// Update project count text\r\nfunction updateProjectCount (count) {\r\n  $(PROJECTS_COUNT_SELECTOR).text(`Showing ${count} project${count !== 1 ? 's' : ''}:`);\r\n}\r\n"]}