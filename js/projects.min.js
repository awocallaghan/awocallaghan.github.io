"use strict";var PROJECTS_SELECTOR="#projects",PROJECT_SELECTOR=".post-preview",PROJECT_FILTERS_SELECTOR="#projects-filters",PROJECT_FILTERS_HTML="/html/project-filters.html",PROJECT_FILTERS_NUM_TYPES=3,PROJECTS_COUNT_SELECTOR="#projects-count",PROJECTS_DATA="projects",PROJECT_DATA="project",DEBUG=!1;function initFilters(e,t){var r=e.find("h2");$.get(PROJECT_FILTERS_HTML,function(e){r.append('<a class="filter-toggler collapsed" data-toggle="collapse" href="#projects-filters"><i class="fa fa-filter" aria-hidden="true"></i>Filter</a>'),r.after(e),$("#projects-filters form").on("submit",filtersUpdated)}).fail(function(e){console.error("Unable to get project filters template",e)})}function initProjects(e,t){e.find(PROJECT_SELECTOR).each(function(e){$(this).data(PROJECT_DATA,t[e])})}function filtersUpdated(e){e&&e.preventDefault();var t=$(this).serializeArray().reduce(function(e,t){return t.value&&t.value.length>0&&(e.hasOwnProperty(t.name)?e[t.name].constructor===Array?e[t.name].push(t.value):e[t.name]=[e[t.name],t.value]:e[t.name]=t.value),e},{});t.hasOwnProperty("type")&&t.type.length===PROJECT_FILTERS_NUM_TYPES&&delete t.type;var r=Object.keys(t).filter(function(e){return"search"!==e}),o=$(PROJECTS_SELECTOR+" "+PROJECT_SELECTOR);o.hide();var n=0;o.each(function(e){var a=$(this),s=a.data(PROJECT_DATA);if(!s)throw new Error("No project data for index "+e);var c=!0;if(t.hasOwnProperty("search")){t.search=t.search.toLowerCase();var i=s.name.toLowerCase(),l=s.description.toLowerCase();c=i.indexOf(t.search)>=0||l.indexOf(t.search)>=0}for(var E=0;c&&E<r.length;){var f=r[E],T=t[f];if(T.constructor===Array)if(s[f].constructor===Array){for(var p=!1,u=0;!p&&u<s[f].length;){for(var C=0;!p&&C<T.length;)p=s[f][u]===T[C],C++;u++}c=p}else{for(var O=!1,R=0;!O&&R<T.length;)O=s[f]===T[R],R++;c=O}else if(s[f].constructor===Array){for(var h=!1,d=0;!h&&d<s[f].length;)h=s[f][d]===T,d++;c=h}else c=s[f]===T;DEBUG&&!c?console.log(s[f],"does not match filter:",T):DEBUG&&console.log(s[f],"matches filter:",T),E++}c&&(a.show(),n+=1),e===o.length-1&&updateProjectCount(n)})}function resetFilters(){$(PROJECT_FILTERS_SELECTOR+" form")[0].reset(),filtersUpdated()}function initProjectCount(e,t){e.find(PROJECT_FILTERS_SELECTOR).after('<span id="projects-count"></span>'),updateProjectCount(t.length)}function updateProjectCount(e){$(PROJECTS_COUNT_SELECTOR).text("Showing "+e+" project"+(1!==e?"s":"")+":")}$(function(){var e=$(PROJECTS_SELECTOR);$.get("/api/projects.json",function(t){t.projects=t.projects.slice(0,t.projects.length-1),DEBUG&&console.log("Successfully loaded projects data",t),e.data(PROJECTS_DATA,t),initFilters(e,t.projects),initProjects(e,t.projects),initProjectCount(e,t.projects)}).fail(function(e){console.error("Error loading project data",e),console.log(e.responseText)})});