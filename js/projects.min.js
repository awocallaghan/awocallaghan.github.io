"use strict";function initFilters(a,b){var c=a.find("h2");$.get(PROJECT_FILTERS_HTML,function(a){c.append('<a class="filter-toggler collapsed" data-toggle="collapse" href="#projects-filters"><i class="fa fa-filter" aria-hidden="true"></i>Filter</a>'),c.after(a),$("#projects-filters form").on("submit",filtersUpdated)}).fail(function(a){console.error("Unable to get project filters template",a)})}function initProjects(a,b){a.find(PROJECT_SELECTOR).each(function(a){$(this).data(PROJECT_DATA,b[a])})}function filtersUpdated(a){a&&a.preventDefault();var b=$(this).serializeArray().reduce(function(a,b){return b.value&&b.value.length>0&&(a.hasOwnProperty(b.name)?a[b.name].constructor===Array?a[b.name].push(b.value):a[b.name]=[a[b.name],b.value]:a[b.name]=b.value),a},{});b.hasOwnProperty("type")&&b.type.length===PROJECT_FILTERS_NUM_TYPES&&delete b.type;var c=Object.keys(b).filter(function(a){return"search"!==a}),d=$(PROJECTS_SELECTOR+" "+PROJECT_SELECTOR);d.hide();var e=0;d.each(function(a){var f=$(this),g=f.data(PROJECT_DATA);if(!g)throw new Error("No project data for index "+a);var h=!0;if(b.hasOwnProperty("search")){b.search=b.search.toLowerCase();var i=g.name.toLowerCase(),j=g.description.toLowerCase();h=i.indexOf(b.search)>=0||j.indexOf(b.search)>=0}for(var k=0;h&&k<c.length;){var l=c[k],m=b[l];if(m.constructor===Array)if(g[l].constructor===Array){for(var n=!1,o=0;!n&&o<g[l].length;){for(var p=0;!n&&p<m.length;)n=g[l][o]===m[p],p++;o++}h=n}else{for(var q=!1,r=0;!q&&r<m.length;)q=g[l]===m[r],r++;h=q}else if(g[l].constructor===Array){for(var s=!1,t=0;!s&&t<g[l].length;)s=g[l][t]===m,t++;h=s}else h=g[l]===m;DEBUG&&!h?console.log(g[l],"does not match filter:",m):DEBUG&&console.log(g[l],"matches filter:",m),k++}h&&(f.show(),e+=1),a===d.length-1&&updateProjectCount(e)})}function resetFilters(){$(PROJECT_FILTERS_SELECTOR+" form")[0].reset(),filtersUpdated()}function initProjectCount(a,b){a.find(PROJECT_FILTERS_SELECTOR).after('<span id="projects-count"></span>'),updateProjectCount(b.length)}function updateProjectCount(a){$(PROJECTS_COUNT_SELECTOR).text("Showing "+a+" project"+(1!==a?"s":"")+":")}var PROJECTS_SELECTOR="#projects",PROJECT_SELECTOR=".post-preview",PROJECT_FILTERS_SELECTOR="#projects-filters",PROJECT_FILTERS_HTML="/html/project-filters.html",PROJECT_FILTERS_NUM_TYPES=3,PROJECTS_COUNT_SELECTOR="#projects-count",PROJECTS_DATA="projects",PROJECT_DATA="project",DEBUG=!1;$(function(){var a=$(PROJECTS_SELECTOR);$.get("/api/projects.json",function(b){b.projects=b.projects.slice(0,b.projects.length-1),DEBUG&&console.log("Successfully loaded projects data",b),a.data(PROJECTS_DATA,b),initFilters(a,b.projects),initProjects(a,b.projects),initProjectCount(a,b.projects)}).fail(function(a){console.error("Error loading project data",a),console.log(a.responseText)})});